"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2949],{2949:(ci,w,l)=>{l.r(w),l.d(w,{VerLicitacionesPageModule:()=>oi});var Z=l(6814),x=l(95),d=l(9843),f=l(7564),g=l(5861),O=l(1486),J=l(6676),i=l(6689),S=l(2338),N=l(930),I=l(4433),Y=l(7153),E=l(2425),F=l(7602),Q=l(6991);let D=(()=>{var n;class a{transform(o,e){const c=[];if(!e)return o;if(o)for(const u of o){var r,p;(null==u||null===(r=u.portal)||void 0===r?void 0:r.toLowerCase().indexOf(e.toLowerCase()))>-1&&c.push(u),(null==u||null===(p=u.noProcedimiento)||void 0===p?void 0:p.toLowerCase().indexOf(e.toLowerCase()))>-1&&c.push(u)}return(0,Q.o)(c)}}return(n=a).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=i.Yjl({name:"licitacionSearch",type:n,pure:!0}),a})();function G(n,a){if(1&n){const t=i.EpF();i.TgZ(0,"ion-button",17),i.NdJ("click",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.click("in"))}),i.TgZ(1,"ion-label"),i._uU(2),i.qZA(),i.TgZ(3,"input",18),i.NdJ("change",function(e){i.CHM(t);const c=i.oxw();return i.KtG(c.onFileSelected(e))}),i.qZA()()}if(2&n){const t=i.oxw();i.Q6J("color",null!=t.file&&t.file.uri?"success":"primary"),i.xp6(2),i.Oqu(null!=t.file&&t.file.uri?"Archivo Cargado":"Subir Licitaciones")}}const B=function(){return["/dashboard/licitaciones/crear-licitaciones"]};function j(n,a){1&n&&(i.TgZ(0,"ion-button",19),i._uU(1," Crear Licitaci\xf3n "),i.qZA()),2&n&&i.Q6J("routerLink",i.DdM(1,B))}function R(n,a){1&n&&(i.TgZ(0,"th",12),i._uU(1,"Opciones"),i.qZA())}function H(n,a){if(1&n){const t=i.EpF();i.TgZ(0,"td")(1,"ion-buttons",22)(2,"ion-button",23),i._UZ(3,"ion-icon",24),i.qZA(),i.TgZ(4,"ion-button",25),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit,c=i.oxw(2);return i.KtG(c.deleteEvento(e.id))}),i._UZ(5,"ion-icon",26),i.qZA(),i.TgZ(6,"ion-button",25),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit,c=i.oxw(2);return c.openModal=!0,i.KtG(c.licitacionModal=e)}),i._UZ(7,"ion-icon",27),i.qZA()()()}if(2&n){const t=i.oxw().$implicit;i.xp6(2),i.MGl("routerLink","editar-licitaciones/",t.id,"")}}function K(n,a){if(1&n&&(i.TgZ(0,"tr")(1,"th",21),i._uU(2),i.qZA(),i.TgZ(3,"td"),i._uU(4),i.qZA(),i.TgZ(5,"td"),i._uU(6),i.qZA(),i.YNc(7,H,8,1,"td",14),i.qZA()),2&n){const t=a.$implicit,o=i.oxw(2);i.xp6(2),i.hij(" ",t.portal," "),i.xp6(2),i.Oqu(t.noProcedimiento),i.xp6(2),i.Oqu(t.dependencia),i.xp6(1),i.Q6J("ngIf",o.visible)}}function z(n,a){if(1&n&&(i.TgZ(0,"tbody"),i.YNc(1,K,8,4,"tr",20),i.ALo(2,"licitacionSearch"),i.qZA()),2&n){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",i.xi3(2,1,t.licitaciones.slice(t.pagina*t.divisor,(t.pagina+1)*t.divisor),t.search))}}function W(n,a){if(1&n){const t=i.EpF();i.TgZ(0,"td")(1,"ion-buttons",22)(2,"ion-button",23),i._UZ(3,"ion-icon",24),i.qZA(),i.TgZ(4,"ion-button",25),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit,c=i.oxw(2);return i.KtG(c.deleteEvento(e.id))}),i._UZ(5,"ion-icon",26),i.qZA(),i.TgZ(6,"ion-button",25),i.NdJ("click",function(){i.CHM(t);const e=i.oxw().$implicit,c=i.oxw(2);return c.openModal=!0,i.KtG(c.licitacionModal=e)}),i._UZ(7,"ion-icon",27),i.qZA()()()}if(2&n){const t=i.oxw().$implicit;i.xp6(2),i.MGl("routerLink","editar-licitaciones/",t.id,"")}}function X(n,a){if(1&n&&(i.TgZ(0,"tr")(1,"th",21),i._uU(2),i.qZA(),i.TgZ(3,"td"),i._uU(4),i.qZA(),i.TgZ(5,"td"),i._uU(6),i.qZA(),i.YNc(7,W,8,1,"td",14),i.qZA()),2&n){const t=a.$implicit,o=i.oxw(2);i.xp6(2),i.hij(" ",t.portal," "),i.xp6(2),i.Oqu(t.noProcedimiento),i.xp6(2),i.Oqu(t.vigencia),i.xp6(1),i.Q6J("ngIf",o.visible)}}function $(n,a){if(1&n&&(i.TgZ(0,"tbody"),i.YNc(1,X,8,4,"tr",20),i.qZA()),2&n){const t=i.oxw();i.xp6(1),i.Q6J("ngForOf",t.licitacionesSelected)}}function ii(n,a){if(1&n){const t=i.EpF();i.TgZ(0,"ion-header")(1,"ion-toolbar",28)(2,"ion-buttons",29)(3,"ion-button",30),i.NdJ("click",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.openModal=!1)}),i._uU(4,"Cerrar"),i.qZA()(),i.TgZ(5,"ion-title"),i._uU(6),i.qZA()()(),i.TgZ(7,"ion-content",31)(8,"ion-list")(9,"ion-item")(10,"ion-label"),i._uU(11," Procedimiento "),i.TgZ(12,"p"),i._uU(13),i.qZA()()(),i.TgZ(14,"ion-item")(15,"ion-label"),i._uU(16," Portal "),i.TgZ(17,"p"),i._uU(18),i.qZA()()(),i.TgZ(19,"ion-item")(20,"ion-label"),i._uU(21," Num. Procedimiento "),i.TgZ(22,"p"),i._uU(23),i.qZA()()(),i.TgZ(24,"ion-item")(25,"ion-label"),i._uU(26," Descripci\xf3n de Expediente "),i.TgZ(27,"p",32),i._uU(28),i.qZA()()(),i.TgZ(29,"ion-item")(30,"ion-label"),i._uU(31," Fecha de Publicaci\xf3n "),i.TgZ(32,"p"),i._uU(33),i.qZA()()(),i.TgZ(34,"ion-item")(35,"ion-label"),i._uU(36," Fecha Limite de Bases "),i.TgZ(37,"p"),i._uU(38),i.qZA()()(),i.TgZ(39,"ion-item")(40,"ion-label"),i._uU(41," Fecha de Apertura "),i.TgZ(42,"p"),i._uU(43),i.qZA()()(),i.TgZ(44,"ion-item")(45,"ion-label"),i._uU(46," Fallo "),i.TgZ(47,"p"),i._uU(48),i.qZA()()(),i.TgZ(49,"ion-item")(50,"ion-label"),i._uU(51," Vigencia "),i.TgZ(52,"p"),i._uU(53),i.qZA()()(),i.TgZ(54,"ion-item")(55,"ion-label"),i._uU(56," Link "),i.TgZ(57,"p"),i._uU(58),i.qZA()()()()()}if(2&n){const t=i.oxw();i.xp6(6),i.Oqu(t.licitacionModal.noProcedimiento),i.xp6(7),i.Oqu(t.licitacionModal.procedimiento),i.xp6(5),i.Oqu(t.licitacionModal.portal),i.xp6(5),i.Oqu(t.licitacionModal.noProcedimiento),i.xp6(5),i.Oqu(t.licitacionModal.descripcionExpediente),i.xp6(5),i.Oqu(t.licitacionModal.fechaPublicacion),i.xp6(5),i.Oqu(t.mon(t.licitacionModal.fechaLimiteBases)),i.xp6(5),i.Oqu(t.mon(t.licitacionModal.fechaapertura)),i.xp6(5),i.Oqu(t.mon(t.licitacionModal.fallo)),i.xp6(5),i.Oqu(t.licitacionModal.vigencia),i.xp6(5),i.Oqu(t.licitacionModal.link)}}const ei=[{path:"",component:(()=>{var n;class a{constructor(o,e,c,r,p){this.licitacionRepo=o,this.genericService=e,this.alert=c,this.loading=r,this.toast=p,this.visible=!0,this.licitaciones=[],this.licitacionesToCreate=[],this.openModal=!1,this.licitacionesSelected=[],this.divisor=15,this.pagina=0}ngOnInit(){this.licitacionRepo.licitaciones$.subscribe(o=>{this.licitaciones=o,this.licitacionesSelected=o.slice(0,this.divisor)})}mon(o){return J(o).locale("es").format("L")+" "+J(new Date(o)).utc().format("LTS")}deleteEvento(o){var e=this;return(0,g.Z)(function*(){var c;yield e.alert.setData({animated:!0,header:"Est\xe1 a punto de eliminar esta licitaci\xf3n",message:"Si lo elimina se perder\xe1n todos los datos relacionados. \n \xbfDesea continuar?",buttons:[{text:"Cancelar"},{text:"Confirmar",handler:(c=(0,g.Z)(function*(){e.loading.setData({animated:!0,message:"Eliminando",spinner:"dots"}),yield e.loading.create(),yield e.loading.show(),e.genericService.delete("licitaciones",o).subscribe(function(){var r=(0,g.Z)(function*(p){yield e.loading.hide(),e.toast.success("Licitaci\xf3n Eliminada"),e.licitacionRepo.deleteLicitacion(o)});return function(p){return r.apply(this,arguments)}}())}),function(){return c.apply(this,arguments)})}]})})()}onFileSelected(o){var e=this;return(0,g.Z)(function*(){if(e.loading.setData({animated:!0,message:"Cargando licitaciones",spinner:"dots"}),yield e.loading.create(),yield e.loading.show(),e.file={documento:"file",uri:o.target.files[0]},e.file){const c=new FileReader;c.onload=function(){var r=(0,g.Z)(function*(p){const _=O.ij(p.target.result,{type:"binary"});let m=O.P6.sheet_to_json(_.Sheets[_.SheetNames[0]],{header:1});m=m.filter(s=>s.some(V=>null!=V&&""!==V)),m.shift();for(let s of m){var v,T,b,L,P,y,A,U,M,C,q;e.licitacionesToCreate.push({procedimiento:null!==(v=s[1])&&void 0!==v?v:null,portal:null!==(T=s[2])&&void 0!==T?T:null,noProcedimiento:null!==(b=s[3])&&void 0!==b?b:null,unidadCompradora:null!==(L=s[4])&&void 0!==L?L:null,descripcionExpediente:null!==(P=s[5])&&void 0!==P?P:null,fechaPublicacion:null!==(y=new Date(24*(s[6]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==y?y:void 0,fechaLimiteBases:null!==(A=new Date(24*(s[7]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==A?A:void 0,fechaapertura:null!==(U=new Date(24*(s[8]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==U?U:void 0,fallo:null!==(M=new Date(24*(s[9]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==M?M:void 0,vigencia:null!==(C=s[10])&&void 0!==C?C:null,link:null!==(q=s[11])&&void 0!==q?q:null})}const k=[];for(let s=0;s<e.licitacionesToCreate.length;s+=100)k.push(e.licitacionesToCreate.slice(s,s+100));yield e.loading.hide(),console.log(e.licitacionesToCreate),yield e.alertMassiveUpload(k)});return function(p){return r.apply(this,arguments)}}(),c.readAsBinaryString(e.file.uri)}})()}click(o){document.getElementById(o).click()}alertMassiveUpload(o){var e=this;return(0,g.Z)(function*(){var c;yield e.alert.setData({animated:!0,header:"Se van a subir y/o actualizar "+e.licitacionesToCreate.length+" licitaciones",message:"Esto puede tomar un tiempo \xbfDesea Continuar?",buttons:[{text:"Cancelar",handler:()=>{const c=document.getElementById("in");c&&(c.value=""),e.licitacionesToCreate=[],e.file={}}},{text:"Cargar Licitaciones",handler:(c=(0,g.Z)(function*(){e.loading.setData({animated:!0,message:"Subiendo Licitaciones espere...",spinner:"dots"}),yield e.loading.create(),yield e.loading.show();for(const p of o){const u=yield e.genericService.post("licitaciones/massive",p).toPromise();for(let h of u.updates)e.licitaciones=e.licitaciones.map(m=>m.id===h.id?h:m);const _=[...e.licitaciones,...u.nuevos];e.licitacionRepo.setLicitacion(_)}e.toast.success("Licitaciones Guardadas"),yield e.loading.hide(),e.file={};const r=document.getElementById("in");e.licitacionesToCreate=[],r&&(r.value="")}),function(){return c.apply(this,arguments)})}]})})()}getPagina(o){this.pagina=o,this.licitacionesSelected=this.licitaciones.slice(o*this.divisor,(o+1)*this.divisor)}}return(n=a).\u0275fac=function(o){return new(o||n)(i.Y36(S.X),i.Y36(N.M),i.Y36(I.c),i.Y36(Y.b),i.Y36(E._W))},n.\u0275cmp=i.Xpm({type:n,selectors:[["ver-licitaciones"]],inputs:{visible:"visible"},decls:30,vars:11,consts:[[3,"fullscreen"],["color","dark",1,"py-2"],[1,"ms-2","ms-md-5","mb-0","titulo"],[1,"palito","ms-2","ms-md-5","mt-0","mb-3"],["slot","end","shape","round","class","mx-1 mt-2","expand","block",3,"color","click",4,"ngIf"],["slot","end","class","mx-1 mt-2","routerLinkActive","router-link-active","shape","round",3,"routerLink",4,"ngIf"],[1,"mt-1","px-3"],[1,"container"],[1,"d-flex","mt-5"],["placeholder","Buscar licitaci\xf3n","inputmode","text","type","text",1,"ms-auto","me-3","my-0","w-100",3,"ngModel","debounce","ngModelChange"],[1,"table","mt-0"],[1,"red"],["scope","col",1,"red"],["scope","col","class","red",4,"ngIf"],[4,"ngIf"],[3,"total","divisor","pagina"],["trigger","open-modal",3,"isOpen","willDismiss"],["slot","end","shape","round","expand","block",1,"mx-1","mt-2",3,"color","click"],["id","in","type","file","accept",".xls, .cvc, .xlsx",2,"display","none",3,"change"],["slot","end","routerLinkActive","router-link-active","shape","round",1,"mx-1","mt-2",3,"routerLink"],[4,"ngFor","ngForOf"],["scope","row",1,"text-center"],["color","primary","slot","start"],["color","primary",3,"routerLink"],["slot","icon-only","name","create-outline"],["color","primary",3,"click"],["slot","icon-only","name","trash-outline"],["slot","icon-only","name","eye-outline"],["color","dark"],["slot","start"],["color","primary","fill","solid",3,"click"],[1,"ion-padding"],[2,"white-space","pre-wrap"]],template:function(o,e){1&o&&(i.TgZ(0,"ion-content",0),i._UZ(1,"br"),i.TgZ(2,"ion-toolbar",1),i._UZ(3,"br"),i.TgZ(4,"h1",2)(5,"b"),i._uU(6," Licitaciones"),i.qZA()(),i._UZ(7,"hr",3),i.YNc(8,G,4,2,"ion-button",4),i.YNc(9,j,2,2,"ion-button",5),i.qZA(),i.TgZ(10,"div",6)(11,"div",7)(12,"div",8),i._UZ(13,"hr"),i.TgZ(14,"ion-searchbar",9),i.NdJ("ngModelChange",function(r){return e.search=r})("ngModelChange",function(){return e.licitacionesSelected=[]}),i.qZA()(),i.TgZ(15,"table",10)(16,"thead",11)(17,"tr")(18,"th",12),i._uU(19,"Portal"),i.qZA(),i.TgZ(20,"th",12),i._uU(21,"No. Procedimiento"),i.qZA(),i.TgZ(22,"th",12),i._uU(23,"Vigencia"),i.qZA(),i.YNc(24,R,2,0,"th",13),i.qZA()(),i.YNc(25,z,3,4,"tbody",14),i.YNc(26,$,2,1,"tbody",14),i.qZA(),i.TgZ(27,"paginador",15),i.NdJ("pagina",function(r){return e.getPagina(r)}),i.qZA()()(),i.TgZ(28,"ion-modal",16),i.NdJ("willDismiss",function(){return e.openModal=!1}),i.YNc(29,ii,59,11,"ng-template"),i.qZA()()),2&o&&(i.Q6J("fullscreen",!0),i.xp6(8),i.Q6J("ngIf",e.visible),i.xp6(1),i.Q6J("ngIf",e.visible),i.xp6(5),i.Q6J("ngModel",e.search)("debounce",250),i.xp6(10),i.Q6J("ngIf",e.visible),i.xp6(1),i.Q6J("ngIf",0===e.licitacionesSelected.length),i.xp6(1),i.Q6J("ngIf",e.licitacionesSelected.length>0),i.xp6(1),i.Q6J("total",e.licitaciones.length)("divisor",e.divisor),i.xp6(1),i.Q6J("isOpen",e.openModal))},dependencies:[Z.sg,Z.O5,x.JJ,x.On,d.YG,d.Sm,d.W2,d.Gu,d.gu,d.Ie,d.Q$,d.q_,d.VI,d.wd,d.sr,d.ki,d.j9,d.YI,f.rH,f.Od,F.a,D],styles:["ion-searchbar[_ngcontent-%COMP%]{width:250px;border-radius:15px!important;border-start-end-radius:10px}ion-img[_ngcontent-%COMP%]{width:150px}.red[_ngcontent-%COMP%]{background-color:red;color:#fff}"]}),a})()}];let ti=(()=>{var n;class a{}return(n=a).\u0275fac=function(o){return new(o||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[f.Bz.forChild(ei),f.Bz]}),a})();var ni=l(3386);let oi=(()=>{var n;class a{}return(n=a).\u0275fac=function(o){return new(o||n)},n.\u0275mod=i.oAB({type:n}),n.\u0275inj=i.cJS({imports:[Z.ez,x.u5,d.Pc,ti,F.a,ni.d]}),a})()}}]);