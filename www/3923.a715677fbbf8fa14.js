"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3923],{3923:(G,y,n)=>{n.r(y),n.d(y,{CrearApoyoPageModule:()=>M});var h=n(6814),d=n(95),l=n(9843),g=n(7564),m=n(5861),p=n(8915),v=n(4664),b=n(6528),A=n(553),o=n(6689),C=n(930),Z=n(2264),P=n(7153),x=n(2425),J=n(2051);function T(t,c){if(1&t){const s=o.EpF();o.TgZ(0,"ion-button",15),o.NdJ("click",function(){o.CHM(s);const r=o.oxw();return o.KtG(r.save())}),o._uU(1," Crear "),o.qZA()}if(2&t){const s=o.oxw();o.Q6J("disabled",s.form.invalid)}}function I(t,c){if(1&t){const s=o.EpF();o.TgZ(0,"ion-button",15),o.NdJ("click",function(){o.CHM(s);const r=o.oxw();return o.KtG(r.update())}),o._uU(1," Guardar Cambios "),o.qZA()}if(2&t){const s=o.oxw();o.Q6J("disabled",s.form.invalid)}}const U=[{path:"",component:(()=>{var t;class c{constructor(e,r,i,u,a,f,N,F,D){this.gService=e,this.compress=r,this.fb=i,this.load=u,this.toast=a,this.params=f,this.apoyosR=N,this.nav=F,this.modalC=D,this.toolbar=[[{heading:["h1","h2","h3","h4","h5","h6"]}],["bold","italic"],["underline","strike"],["ordered_list","bullet_list"],["align_left","align_center","align_right","align_justify"],["horizontal_rule","format_clear"],["text_color","background_color"]],this.uri=A.N.image+"apoyos-dn/"}ngOnInit(){var e=this;this.form=this.fb.group({titulo:[null,p.kI.required],descripcion:[null,p.kI.required]}),this.editor=new p.ML,this.params.params.pipe((0,v.w)(r=>{var i;return this.identificador=Number(null!==(i=null==r?void 0:r.identificador)&&void 0!==i?i:0),this.apoyosR.user$})).subscribe(function(){var r=(0,m.Z)(function*(i){if(0!==e.identificador){const u=i.find(a=>a.id===e.identificador);e.form.setValue({titulo:u.titulo,descripcion:u.descripcion}),e.imagen=e.uri+u.imagen}});return function(i){return r.apply(this,arguments)}}())}getImage(){var e=this;return(0,m.Z)(function*(){e.imagen=yield e.compress.returnImageCompress();const r=yield e.modalC.create({component:b.n,animated:!0,componentProps:{imageUrl:e.imagen}});r.onDidDismiss().then(({data:i})=>{e.imagen=null!=i?i:null}),yield r.present()})()}save(){var e=this;return(0,m.Z)(function*(){let r;yield e.load.setData({animated:!0,spinner:"dots",translucent:!0,message:"Creando Apoyo..."}),yield e.load.create(),yield e.load.show(),r="string"!=typeof e.form.controls.descripcion.value?(0,p.io)(e.form.controls.descripcion.value):e.form.controls.descripcion.value,e.form.controls.descripcion.setValue(r);const i=new FormData;for(const a in e.form.value)e.form.value.hasOwnProperty(a)&&"costos"!==a&&i.append(a,e.form.value[a]);e.imagen&&i.append("imagen",e.compress.dataURItoBlob(e.imagen));const u=e.form.controls.titulo.value.replace(/ /g,"-");i.append("identificador",u.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),e.gService.post("desastres",i).subscribe(function(){var a=(0,m.Z)(function*(f){e.imagen=null,e.form.reset({}),yield e.load.hide(),e.toast.success("Apoyo Guardado")});return function(f){return a.apply(this,arguments)}}())})()}update(){var e=this;return(0,m.Z)(function*(){let r;yield e.load.setData({animated:!0,spinner:"dots",translucent:!0,message:"Guardando Cambios..."}),yield e.load.create(),yield e.load.show(),r="string"!=typeof e.form.controls.descripcion.value?(0,p.io)(e.form.controls.descripcion.value):e.form.controls.descripcion.value,e.form.controls.descripcion.setValue(r);const i=new FormData;for(const a in e.form.value)e.form.value.hasOwnProperty(a)&&"imagen"!==a&&i.append(a,e.form.value[a]);e.imagen.includes("data:")&&i.append("imagen",e.compress.dataURItoBlob(e.imagen));const u=e.form.controls.titulo.value.replace(/ /g,"-");i.append("identificador",u.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),e.gService.updateWhitImage("desastres",e.identificador,i).subscribe(function(){var a=(0,m.Z)(function*(f){e.imagen=null,e.form.reset({}),yield e.load.hide(),e.apoyosR.updateApoyo(e.identificador,f),e.toast.success("Apoyo Guardado"),e.nav.navigateForward("/dashboard/apoyos")});return function(f){return a.apply(this,arguments)}}())})()}}return(t=c).\u0275fac=function(e){return new(e||t)(o.Y36(C.M),o.Y36(Z.Y),o.Y36(d.qu),o.Y36(P.b),o.Y36(x._W),o.Y36(g.gz),o.Y36(J.d),o.Y36(l.SH),o.Y36(l.IN))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-crear-apoyo"]],decls:22,vars:10,consts:[[3,"fullscreen"],["color","dark",1,"py-2"],[1,"ms-2","ms-md-5","mb-0","titulo"],[1,"palito","ms-2","ms-md-5","mt-0","mb-3"],[1,"container"],[3,"formGroup"],["lines","none",1,"border","mt-2"],["label","Titulo","labelPlacement","floating","required","","formControlName","titulo","type","text"],["button","","lines","none",1,"ion-margin-vertical","border",3,"click"],["slot","start","color","primary"],["slot","end",2,"max-width","300px",3,"src"],[1,"NgxEditor__Wrapper"],[3,"toolbar","editor"],["formControlName","descripcion",3,"editor","placeholder"],["expand","block","class","my-3","shape","round","color","primary",3,"disabled","click",4,"ngIf"],["expand","block","shape","round","color","primary",1,"my-3",3,"disabled","click"]],template:function(e,r){1&e&&(o.TgZ(0,"ion-content",0),o._UZ(1,"br"),o.TgZ(2,"ion-toolbar",1),o._UZ(3,"br"),o.TgZ(4,"h1",2)(5,"b"),o._uU(6),o.qZA()(),o._UZ(7,"hr",3),o.qZA(),o.TgZ(8,"div",4)(9,"form",5)(10,"ion-item",6),o._UZ(11,"ion-input",7),o.qZA(),o.TgZ(12,"ion-item",8),o.NdJ("click",function(){return r.getImage()}),o.TgZ(13,"ion-text",9)(14,"h5"),o._uU(15,"Subir Imagen"),o.qZA()(),o._UZ(16,"ion-img",10),o.qZA(),o.TgZ(17,"div",11),o._UZ(18,"ngx-editor-menu",12)(19,"ngx-editor",13),o.qZA(),o.YNc(20,T,2,1,"ion-button",14),o.YNc(21,I,2,1,"ion-button",14),o.qZA()()()),2&e&&(o.Q6J("fullscreen",!0),o.xp6(6),o.hij(" ",0!==r.identificador?"Editar Apoyo":"Crear Apoyo",""),o.xp6(3),o.Q6J("formGroup",r.form),o.xp6(7),o.Q6J("src",r.imagen),o.xp6(2),o.Q6J("toolbar",r.toolbar)("editor",r.editor),o.xp6(1),o.Q6J("editor",r.editor)("placeholder","Descripci\xf3n del evento"),o.xp6(1),o.Q6J("ngIf",0===r.identificador||!r.identificador),o.xp6(1),o.Q6J("ngIf",0!==r.identificador))},dependencies:[h.O5,d._Y,d.JJ,d.JL,d.Q7,d.sg,d.u,l.YG,l.W2,l.Xz,l.pK,l.Ie,l.yW,l.sr,l.j9,p.tP,p.Mn]}),c})()}];let Y=(()=>{var t;class c{}return(t=c).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[g.Bz.forChild(U),g.Bz]}),c})(),M=(()=>{var t;class c{}return(t=c).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[h.ez,d.u5,d.UX,l.Pc,Y,p.FP]}),c})()}}]);