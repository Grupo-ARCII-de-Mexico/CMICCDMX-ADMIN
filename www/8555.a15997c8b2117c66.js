"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8555],{8555:(H,S,l)=>{l.r(S),l.d(S,{CrearLicitacionesPageModule:()=>z});var J=l(6814),d=l(95),r=l(9843),Z=l(7564),u=l(5861),B=l(1486),E=l(4664),R=l(9397),e=l(6689),w=l(2425),Y=l(7153),I=l(2338),j=l(930),k=l(4433);const D=[{path:"",component:(()=>{var n;class m{constructor(t,i,a,c,f,g,h,v,s){this.fb=t,this.toast=i,this.load=a,this.licitacionRepo=c,this.genericService=f,this.activeParams=g,this.nav=h,this.loading=v,this.alert=s,this.year=(new Date).getFullYear(),this.edit=!1,this.licitaciones=[],this.licitacionesToCreate=[],this.openModal=!1}ngOnInit(){this.licitacionRepo.licitaciones$.subscribe(t=>{this.licitaciones=t}),this.licitacionForm=this.fb.group({procedimiento:[null],portal:[null],noProcedimiento:[null],unidadCompradora:[null],descripcionExpediente:[null],fechaPublicacion:[null],fechaLimiteBases:[null],fechaapertura:[null],fallo:[null],vigencia:[null],link:[null]}),this.activeParams.params.pipe((0,E.w)(t=>(this.identificador=t.identificador,t.identificador&&(this.edit=!0),this.licitacionRepo.licitaciones$)),(0,R.b)(t=>{if(this.edit){const i=t.find(a=>a.id===Number(this.identificador));i&&this.licitacionForm.setValue({procedimiento:i.procedimiento,portal:i.portal,noProcedimiento:i.noProcedimiento,unidadCompradora:i.unidadCompradora,descripcionExpediente:i.descripcionExpediente,fechaPublicacion:i.fechaPublicacion,fechaLimiteBases:i.fechaLimiteBases,fechaapertura:i.fechaapertura,fallo:i.fallo,vigencia:i.vigencia,link:i.link})}})).subscribe()}save(){var t=this;return(0,u.Z)(function*(){t.edit?yield t.update():(yield t.load.setData({animated:!0,spinner:"dots",translucent:!0,message:"Creando Licitaci\xf3n..."}),yield t.load.create(),yield t.load.show(),t.genericService.post("licitaciones",t.licitacionForm.value).subscribe(function(){var i=(0,u.Z)(function*(a){t.licitacionForm.reset(),t.licitacionRepo.addLicitacion(a),yield t.load.hide(),t.toast.success("Licitaci\xf3n Guardada"),t.nav.navigateForward("/dashboard/licitaciones")});return function(a){return i.apply(this,arguments)}}()))})()}update(){var t=this;return(0,u.Z)(function*(){yield t.load.setData({animated:!0,spinner:"dots",translucent:!0,message:"Guardando Cambios..."}),yield t.load.create(),yield t.load.show(),t.genericService.update("licitaciones",Number(t.identificador),t.licitacionForm.value).subscribe(function(){var i=(0,u.Z)(function*(a){t.licitacionForm.reset(),t.licitacionRepo.updateLicitacion(Number(t.identificador),a),yield t.load.hide(),t.toast.success("Licitaci\xf3n Actualizada"),t.nav.navigateForward("/dashboard/licitaciones")});return function(a){return i.apply(this,arguments)}}())})()}onFileSelected(t){var i=this;return(0,u.Z)(function*(){if(i.loading.setData({animated:!0,message:"Cargando licitaciones",spinner:"dots"}),yield i.loading.create(),yield i.loading.show(),i.file={documento:"file",uri:t.target.files[0]},i.file){const a=new FileReader;a.onload=function(){var c=(0,u.Z)(function*(f){const h=B.ij(f.target.result,{type:"binary"});let s=B.P6.sheet_to_json(h.Sheets[h.SheetNames[0]],{header:1});s=s.filter(o=>o.some(N=>null!=N&&""!==N)),s.shift();for(let o of s){var C,b,y,P,T,x,L,U,A,F,M;i.licitacionesToCreate.push({procedimiento:null!==(C=o[1])&&void 0!==C?C:null,portal:null!==(b=o[2])&&void 0!==b?b:null,noProcedimiento:null!==(y=o[3])&&void 0!==y?y:null,unidadCompradora:null!==(P=o[4])&&void 0!==P?P:null,descripcionExpediente:null!==(T=o[5])&&void 0!==T?T:null,fechaPublicacion:null!==(x=new Date(24*(o[6]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==x?x:void 0,fechaLimiteBases:null!==(L=new Date(24*(o[7]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==L?L:void 0,fechaapertura:null!==(U=new Date(24*(o[8]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==U?U:void 0,fallo:null!==(A=new Date(24*(o[9]-1)*60*60*1e3+Date.UTC(1900,0,1)))&&void 0!==A?A:void 0,vigencia:null!==(F=o[10])&&void 0!==F?F:null,link:null!==(M=o[11])&&void 0!==M?M:null})}const G=[];for(let o=0;o<i.licitacionesToCreate.length;o+=100)G.push(i.licitacionesToCreate.slice(o,o+100));yield i.loading.hide(),console.log(i.licitacionesToCreate),yield i.alertMassiveUpload(G)});return function(f){return c.apply(this,arguments)}}(),a.readAsBinaryString(i.file.uri)}})()}click(t){document.getElementById(t).click()}alertMassiveUpload(t){var i=this;return(0,u.Z)(function*(){var a;yield i.alert.setData({animated:!0,header:"Se van a subir y/o actualizar "+i.licitacionesToCreate.length+" licitaciones",message:"Esto puede tomar un tiempo \xbfDesea Continuar?",buttons:[{text:"Cancelar",handler:()=>{const a=document.getElementById("in");a&&(a.value=""),i.licitacionesToCreate=[],i.file={}}},{text:"Cargar Licitaciones",handler:(a=(0,u.Z)(function*(){i.loading.setData({animated:!0,message:"Subiendo Licitaciones espere...",spinner:"dots"}),yield i.loading.create(),yield i.loading.show();for(const f of t){const g=yield i.genericService.post("licitaciones/massive",f).toPromise();for(let v of g.updates)i.licitaciones=i.licitaciones.map(s=>s.id===v.id?v:s);const h=[...i.licitaciones,...g.nuevos];i.licitacionRepo.setLicitacion(h)}i.toast.success("Licitaciones Guardadas"),yield i.loading.hide(),i.file={};const c=document.getElementById("in");i.licitacionesToCreate=[],c&&(c.value="")}),function(){return a.apply(this,arguments)})}]})})()}}return(n=m).\u0275fac=function(t){return new(t||n)(e.Y36(d.qu),e.Y36(w._W),e.Y36(Y.b),e.Y36(I.X),e.Y36(j.M),e.Y36(Z.gz),e.Y36(r.SH),e.Y36(Y.b),e.Y36(k.c))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-crear-licitaciones"]],decls:58,vars:10,consts:[[3,"fullscreen"],["color","dark",1,"py-2"],[1,"ms-2","ms-md-5","mb-0","titulo"],[1,"palito","ms-2","ms-md-5","mt-0","mb-3"],["slot","end","shape","round","expand","block",1,"mx-1","mt-2",3,"color","click"],["id","in","type","file","accept",".xls, .cvc, .xlsx",2,"display","none",3,"change"],[1,"mt-1","px-4"],[1,"container"],[3,"formGroup"],[1,"row"],[1,"col-md-4","my-3"],["type","text","label","Procedimiento","labelPlacement","floating","formControlName","procedimiento",1,"border","my-2"],["type","text","label","Portal","labelPlacement","floating","formControlName","portal",1,"border","my-2"],["type","text","label","No. Procedimiento","labelPlacement","floating","formControlName","noProcedimiento",1,"border","my-2"],["type","text","label","Unidad Compradora","labelPlacement","floating","formControlName","unidadCompradora",1,"border","my-2"],["rows","10","type","text","label","Descripci\xf3n de expediente","labelPlacement","floating","formControlName","descripcionExpediente",1,"border","my-2"],[1,"col-md-4","my-3","my-3"],["formControlName","fechaPublicacion",3,"max"],["slot","time-label"],["formControlName","fechaLimiteBases",3,"max"],["formControlName","fechaapertura",3,"max"],["formControlName","fallo",3,"max"],["type","text","label","Vigencia","labelPlacement","floating","formControlName","vigencia",1,"border","my-2"],["type","text","label","Link","labelPlacement","floating","formControlName","link",1,"border","my-2"],["expand","block","shape","round",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content",0),e._UZ(1,"br"),e.TgZ(2,"ion-toolbar",1),e._UZ(3,"br"),e.TgZ(4,"h1",2)(5,"b"),e._uU(6),e.qZA()(),e._UZ(7,"hr",3),e.TgZ(8,"ion-button",4),e.NdJ("click",function(){return i.click("in")}),e.TgZ(9,"ion-label"),e._uU(10),e.qZA(),e.TgZ(11,"input",5),e.NdJ("change",function(c){return i.onFileSelected(c)}),e.qZA()()(),e.TgZ(12,"div",6)(13,"div",7)(14,"form",8)(15,"div",9)(16,"div",10),e._UZ(17,"ion-input",11),e.qZA(),e.TgZ(18,"div",10),e._UZ(19,"ion-input",12),e.qZA(),e.TgZ(20,"div",10),e._UZ(21,"ion-input",13),e.qZA(),e.TgZ(22,"div",10),e._UZ(23,"ion-input",14),e.qZA(),e.TgZ(24,"div",10),e._UZ(25,"ion-input",14),e.qZA(),e.TgZ(26,"div",10),e._UZ(27,"ion-textarea",15),e.qZA(),e.TgZ(28,"div",16)(29,"h5"),e._uU(30,"Fecha de Publicaci\xf3n"),e.qZA(),e.TgZ(31,"ion-datetime",17)(32,"span",18),e._uU(33,"Hora"),e.qZA()()(),e.TgZ(34,"div",16)(35,"h5"),e._uU(36,"Fecha Limite para Bases"),e.qZA(),e.TgZ(37,"ion-datetime",19)(38,"span",18),e._uU(39,"Hora"),e.qZA()()(),e.TgZ(40,"div",16)(41,"h5"),e._uU(42,"Fecha de Apertura"),e.qZA(),e.TgZ(43,"ion-datetime",20)(44,"span",18),e._uU(45,"Hora"),e.qZA()()(),e.TgZ(46,"div",16)(47,"h5"),e._uU(48,"Fecha del Fallo"),e.qZA(),e.TgZ(49,"ion-datetime",21)(50,"span",18),e._uU(51,"Hora"),e.qZA()()(),e.TgZ(52,"div",10),e._UZ(53,"ion-textarea",22),e.qZA(),e.TgZ(54,"div",10),e._UZ(55,"ion-textarea",23),e.qZA()(),e.TgZ(56,"ion-button",24),e.NdJ("click",function(){return i.save()}),e._uU(57),e.qZA()()()()()),2&t&&(e.Q6J("fullscreen",!0),e.xp6(6),e.hij(" ",i.edit?"Editar ":"Crear "," Licitaci\xf3n"),e.xp6(2),e.Q6J("color",null!=i.file&&i.file.uri?"success":"primary"),e.xp6(2),e.Oqu(null!=i.file&&i.file.uri?"Archivo Cargado":"Subir Licitaciones"),e.xp6(4),e.Q6J("formGroup",i.licitacionForm),e.xp6(17),e.MGl("max","",i.year+20,"-01-01"),e.xp6(6),e.MGl("max","",i.year+20,"-01-01"),e.xp6(6),e.MGl("max","",i.year+20,"-01-01"),e.xp6(6),e.MGl("max","",i.year+20,"-01-01"),e.xp6(8),e.hij(" ",i.edit?"Actualizar ":"Crear "," licitaci\xf3n "))},dependencies:[d._Y,d.JJ,d.JL,d.sg,d.u,r.YG,r.W2,r.x4,r.pK,r.Q$,r.g2,r.sr,r.QI,r.j9],styles:["ion-searchbar[_ngcontent-%COMP%]{width:250px;border-radius:15px!important;border-start-end-radius:10px}ion-img[_ngcontent-%COMP%]{width:150px}.red[_ngcontent-%COMP%]{background-color:red;color:#fff}"]}),m})()}];let q=(()=>{var n;class m{}return(n=m).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[Z.Bz.forChild(D),Z.Bz]}),m})(),z=(()=>{var n;class m{}return(n=m).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[J.ez,d.u5,d.UX,r.Pc,q]}),m})()}}]);